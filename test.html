<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="A/B Test Results Analyzer: Modern, robust, and accessible tool for analyzing A/B test results with clear statistics and Monetate branding.">
  <meta name="theme-color" content="#8566AB">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <!-- Monetate Brand/Modern Palette and UI Styles applied -->
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>
  <div id="loaderOverlay">
    <div class="spinner" role="status" aria-label="Loading"></div>
    <div id="loaderStatus" aria-live="polite">Processing...</div>
  </div>
  <div class="header-container" role="banner">
    <h1 tabindex="0">A/B Test Results Analyzer</h1>
  </div>
  <main id="main-content" tabindex="-1">
    <div class="container card" role="main">
      <h2>Modern, Robust, Transparent</h2>
      <form aria-label="A/B Test Analysis Form" style="display: flex; flex-wrap: wrap; align-items: flex-end; gap: 16px;">
        <div style="flex: 1 1 350px; min-width: 250px;">
          <div class="form-group">
            <label for="controlFile">Control File (CSV - Daily Data):</label>
            <input type="file" id="controlFile" accept=".csv" aria-required="true">
          </div>
          <div class="form-group">
            <label for="experimentFile">Experiment File (CSV - Daily Data):</label>
            <input type="file" id="experimentFile" accept=".csv" aria-required="true">
          </div>
          <div class="form-group">
            <label for="analysisMode">Analysis Mode:</label>
            <select id="analysisMode">
              <option value="bootstrap">Bootstrap Confidence Intervals (Recommended)</option>
              <option value="ttest">Welch's T-Test (on Daily Values)</option>
            </select>
          </div>
          <div id="bootstrapOptions" class="form-group">
            <label for="bootstrapIterations">Bootstrap Iterations:</label>
            <input type="number" id="bootstrapIterations" value="3000" min="100" step="100">
          </div>
          <div class="form-group">
            <label for="confidenceLevel">Select Significance Level (Alpha):</label>
            <select id="confidenceLevel">
              <option value="0.05">95% Confidence (Alpha 0.05)</option>
              <option value="0.10">90% Confidence (Alpha 0.10)</option>
              <option value="0.01">99% Confidence (Alpha 0.01)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="goalSelect">Highlight Goal Metric:</label>
            <select id="goalSelect" disabled></select>
          </div>
          <div class="form-group">
            <label for="useSessionWeighting">
              <input type="checkbox" id="useSessionWeighting" checked>
              Weight metric point estimates by session count (for summary values)
            </label>
          </div>
        </div>
        <div style="flex: 0 0 220px; display: flex; flex-direction: column; align-items: flex-end; gap: 10px; min-width: 180px;">
          <button id="runAnalysisBtn" disabled type="submit" style="width: 180px;">Run Analysis</button>
          <button id="exportCsvBtn" style="display:none; width: 180px;" type="button">Download Results as CSV</button>
        </div>
      </form>
      <hr />
      <div id="sessionInfo" aria-live="polite">
        <p>
          <strong>Control Total Sessions:</strong> <span id="controlSessions">N/A</span><br>
          <strong>Experiment Total Sessions:</strong> <span id="experimentSessions">N/A</span>
        </p>
        <p id="sessionWarning" style="display: none;">
          ⚠️ Warning: Large imbalance in session counts may affect reliability of results, especially for t-tests.
        </p>
      </div>
      <table id="comparisonTable" aria-describedby="table-desc">
        <caption id="table-desc" class="sr-only">Comparison of control and experiment metrics, showing absolute and relative changes, uncertainty, and statistical significance.</caption>
        <thead>
          <tr>
            <th scope="col">Metric</th>
            <th scope="col">Control</th>
            <th scope="col">Experiment</th>
            <th scope="col">Abs. Change</th>
            <th scope="col">Rel. Change (%)</th>
            <th scope="col">Uncertainty</th>
            <th scope="col">Significant?</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <section class="info-section" aria-label="How to Use & Statistical Notes">
        <h3>How to Use & Statistical Notes</h3>
        <p><strong>What This Tool Does:</strong></p>
        <ul>
          <li><strong>Upload & Compare:</strong> Upload two CSV files (Control & Experiment) with <strong>daily A/B test data</strong> for the same date range.</li>
          <li><strong>Clear Change Breakdown:</strong> For each metric, see the absolute change (e.g., +£0.15, +2.5pp), relative change (lift, %), and uncertainty (confidence interval or p-value).</li>
          <li><strong>Statistical Rigor:</strong>
              <ul>
                  <li><strong>Bootstrap Mode (Recommended):</strong> Uses robust resampling to estimate a confidence interval (CI) for the lift. <strong>CI = Confidence Interval</strong>: the range of plausible values for the true effect, e.g., "CI: (+2.5%, +8.1%)" means the true lift is likely between +2.5% and +8.1%.</li>
                  <li><strong>Welch's T-Test Mode:</strong> Compares daily means, providing a p-value. Assumes daily values are approximately normal.</li>
              </ul>
          </li>
          <li><strong>Significance Highlighted:</strong> Statistically significant results (at your chosen confidence level) are clearly marked with a star and "Yes" in the table. Arrows indicate direction and whether a change is good or bad for each metric.</li>
          <li><strong>Multiple Metrics Correction:</strong> Adjusts for multiple comparisons using the Benjamini-Hochberg procedure to control false discoveries.</li>
        </ul>
        <p><strong>Best Practices & Caveats:</strong></p>
        <ol>
          <li><strong>Data Quality:</strong> Ensure both CSVs have accurate, daily data for the same date range. Remove outliers and anomalies from both files before upload.</li>
          <li><strong>Significance ≠ Importance:</strong> "Significant? Yes" means the result is unlikely to due to random chance, but always consider the size and business impact of the change. "No" means the test was inconclusive, not that there is no effect.</li>
          <li><strong>Multiple Metrics:</strong> Testing many metrics increases the chance of a false positive. Focus on your primary goal metric(s) for decisions.</li>
          <li><strong>Assumptions:</strong> Bootstrap is robust to non-normality; t-test assumes daily values are roughly normal. Both require representative daily data.</li>
          <li><strong>External Factors:</strong> The tool cannot account for outside events that may have influenced results.</li>
        </ol>
        <p><em>This tool provides statistical evidence. Always combine with business context and judgment for decisions.</em></p>
      </section>
    </div>
  </main>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js"></script> 
  <script src="script.js"></script>
</body>
</html>